<html>
    <head>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
        <title>WebGL TEST</title> 
        
        <!-- スクリプトの読み込み -->
        <script type="text/javascript" src="GameMain.js"></script>
        <script type="text/javascript" src="Shader.js"></script>
        <script type="text/javascript" src="BufferObject.js"></script>
        <script type="text/javascript" src="ModelLoader.js"></script>
        <script type="text/javascript" src="Camera.js"></script>
        <script type="text/javascript" src="Mat4.js"></script>
        <script type="text/javascript" src="Vec3.js"></script>
        <script type="text/javascript" src="Model.js"></script>
        <script type="text/javascript" src="Texture.js"></script>

                    
    </head>
    <body>
        <div align="center">
        <h1>WebGLぜよ</h><br><br>
        <canvas id="canvas"></canvas>
        </div>
        
        <script type="text/javascript">
   		// Canvas要素の取得
		canvas = document.getElementById('canvas');
		canvas.width = 800;
		canvas.height = 400;
		
		// WebGLコンテキストの取得
		gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
        
        // カリングを有効
        gl.enable(gl.CULL_FACE);
        gl.cullFace(gl.FRONT);
        
        // 深度テストを有効
        gl.enable(gl.DEPTH_TEST);
        gl.depthFunc(gl.LEQUAL);
        
        // ピクセルブレンディングを有効化
        gl.enable(gl.BLEND);
        gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA);

		// 背景色の設定
		gl.clearColor(0.0, 0.0, 0.0, 1.0);
        
        // カメラの設定
        camera = new Camera();
        camera.perspective(45, canvas.width / canvas.height, 0.1, 1000.0);
		
		var scene = new GameMain();
        
        // FPS管理用
        var dateObj = new Date();
        var FPS = 1000 / 30;  // フレームレート
        var time;             // 時間格納用
        var deltaTime = 0;    // 1フレームの実行時間
        
        // メインループスタート
        main();
	   
	   // メインループ
	   function main() {
           time = dateObj.getTime();
           
	   		gl.clear(gl.DEPTH_BUFFR_BIT || gl.COLOR_BUFFER_BIT);
	   		
	   		scene.update();
	   		scene.draw();
            
            gl.flush();
            
            deltaTime = dateObj.getTime() - time;
            setTimeout(main, FPS - deltaTime);
	   	}
        </script>
    </body>
</html>